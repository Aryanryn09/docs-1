"use strict";(self.webpackChunkbook=self.webpackChunkbook||[]).push([[6439],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>h});var r=a(7294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var m=r.createContext({}),l=function(e){var t=r.useContext(m),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},c=function(e){var t=l(e.components);return r.createElement(m.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef((function(e,t){var a=e.components,n=e.mdxType,o=e.originalType,m=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),p=l(a),u=n,h=p["".concat(m,".").concat(u)]||p[u]||d[u]||o;return a?r.createElement(h,i(i({ref:t},c),{},{components:a})):r.createElement(h,i({ref:t},c))}));function h(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=a.length,i=new Array(o);i[0]=u;var s={};for(var m in t)hasOwnProperty.call(t,m)&&(s[m]=t[m]);s.originalType=e,s[p]="string"==typeof e?e:n,i[1]=s;for(var l=2;l<o;l++)i[l]=a[l];return r.createElement.apply(null,i)}return r.createElement.apply(null,a)}u.displayName="MDXCreateElement"},2831:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>m,contentTitle:()=>i,default:()=>p,frontMatter:()=>o,metadata:()=>s,toc:()=>l});var r=a(7462),n=(a(7294),a(3905));const o={sidebar_position:4},i="6.4 SIMD",s={unversionedId:"c/simd",id:"c/simd",title:"6.4 SIMD",description:"128-bit packed Single Instruction Multiple Data (SIMD) instructions provide simultaneous computations over packed data in just one instruction. It's commonly used to improve performance for multimedia applications. With the SIMD proposal, the modules can benefit from using these commonly used instructions in modern hardware to gain more speedup.",source:"@site/docs/c/simd.md",sourceDirName:"c",slug:"/c/simd",permalink:"/book/docs/c/simd",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/c/simd.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"6.3 Thread",permalink:"/book/docs/c/threads"},next:{title:"Develop Wasm Apps in Go",permalink:"/book/docs/category/develop-wasm-apps-in-go"}},m={},l=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Compile the C-SIMD application to Wasm-SIMD binary with emcc",id:"compile-the-c-simd-application-to-wasm-simd-binary-with-emcc",level:2},{value:"Run with WasmEdge",id:"run-with-wasmedge",level:2},{value:"Ahead-of-Time mode",id:"ahead-of-time-mode",level:2}],c={toc:l};function p(e){let{components:t,...a}=e;return(0,n.kt)("wrapper",(0,r.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"64-simd"},"6.4 SIMD"),(0,n.kt)("h1",{id:"webassembly-simd-example-in-c"},"WebAssembly SIMD Example in C"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://webassembly.github.io/simd/core/syntax/instructions.html#simd-instructions"},"128-bit packed Single Instruction Multiple Data (SIMD)")," instructions provide simultaneous computations over packed data in just one instruction. It's commonly used to improve performance for multimedia applications. With the SIMD proposal, the modules can benefit from using these commonly used instructions in modern hardware to gain more speedup."),(0,n.kt)("p",null,"If you are interested in enabling the SIMD proposal will improve how much performance of the applications, please refer to our ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/second-state/wasm32-wasi-benchmark/tree/simd"},"wasm32-wasi benchmark")," for more information.\nIn our benchmark, the Mandelbrot Set application can have ",(0,n.kt)("strong",{parentName:"p"},"2.65x")," speedup."),(0,n.kt)("p",null,"We modified the Mandelbrot Set example from our ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/second-state/wasm32-wasi-benchmark/blob/master/src/mandelbrot.c"},"wasm32-wasi benchmark project"),". We will use this as an example in this article."),(0,n.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,n.kt)("p",null,"Before we started, make sure you have installed the following software:"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("a",{parentName:"p",href:"/book/docs/quick-start/install"},"Install WasmEdge"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Emscripten, a toolchain for compiling C/C++ to WebAssembly. Please refer to the ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/emscripten-core/emsdk"},"emcc official repository")," for the detailed instructions."))),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"git clone --depth 1 https://github.com/emscripten-core/emsdk.git\ncd emsdk\n./emsdk install latest\n./emsdk activate latest\nsource ./emsdk_env.sh\n")),(0,n.kt)("h2",{id:"compile-the-c-simd-application-to-wasm-simd-binary-with-emcc"},"Compile the C-SIMD application to Wasm-SIMD binary with emcc"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"emcc -g -Oz --llvm-lto 1 -s STANDALONE_WASM -s INITIAL_MEMORY=32MB -s MAXIMUM_MEMORY=4GB \\\n  -mmutable-globals \\\n  -mnontrapping-fptoint \\\n  -msign-ext \\\n  mandelbrot-simd.c -o mandelbrot-simd.wasm\n")),(0,n.kt)("h2",{id:"run-with-wasmedge"},"Run with WasmEdge"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"wasmedge mandelbrot-simd.wasm 15000\n")),(0,n.kt)("h2",{id:"ahead-of-time-mode"},"Ahead-of-Time mode"),(0,n.kt)("p",null,"With WasmEdge's AoT compiler, you will get higher performance."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"# Compile wasm-simd with wasmedge aot compiler\n$ wasmedgec mandelbrot-simd.wasm mandelbrot-simd-out.wasm\n# Run the native binary with wasmedge\n$ wasmedge mandelbrot-simd-out.wasm 15000\n")))}p.isMDXComponent=!0}}]);